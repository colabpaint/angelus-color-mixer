# Angelus Paint Color Mixer 要件定義書

## 1. プロジェクト概要

### 1.1 目的
Angelus絵の具を使用する際に、目標の色を作るための配合比率を自動計算するシステム。

### 1.2 背景
- Angelusの絵の具で色を作りたい時、既存のラインナップから配合する割合を手動で試行錯誤するのは非効率
- 自動的に最適な配合比率を算出することで、作業効率を向上させる

---

## 2. 使用する色

### 2.1 軸となる基本色（6色）

以下の6色を軸として配合を行う：

| コード | 色名 | 用途 |
|--------|------|------|
| 001 | Black | 暗くする |
| 005 | White | 明るくする |
| 040 | Blue | 青系 |
| 050 | Green | 緑系 |
| 064 | Red | 赤系 |
| 075 | Yellow | 黄系 |

### 2.2 補助色（11色）

より正確な配合のために追加：

| コード | 色名 | 用途 |
|--------|------|------|
| 024 | Orange | 赤〜黄の中間 |
| 047 | Purple | 紫系 |
| 014 | Brown | 茶系 |
| 029 | Tan | ベージュ系 |
| 041 | Light Blue | 水色系 |
| 052 | Midnight Green | 深緑 |
| 060 | Burgundy | ワイン色 |
| 080 | Dark Grey | ダークグレー |
| 082 | Light Grey | ライトグレー |
| 188 | Pink | ピンク系 |
| 186 | Hot Pink | ホットピンク |

### 2.3 配合ルール

- **基本は6色から開始**
- **ΔE >= 5 の場合は段階的に色数を増やす**（6→8→10→...→最大17色）
- ΔE < 5 になるまで、または全色を使い切るまで最適化を継続
- ベース色（目標色に最も近い色）を基準に配合を構成

---

## 3. 機能要件

### 3.1 ターゲット色の入力方法
1. **画像からスポイトで選択**
   - 画像をドラッグ＆ドロップでアップロード
   - 画像をクリップボードからペースト（Ctrl+V）
   - 画像上でクリックして色を取得

2. **手動入力**
   - HEXカラーコード（例：#FF8800）
   - カラーピッカーで選択

### 3.2 画像操作機能
- **ズーム**: マウスホイールで拡大・縮小
- **パン**: 右クリック+ドラッグまたはShift+クリック+ドラッグで移動
- **リセット**: ボタンで元のサイズに戻す
- **ズームボタン**: +拡大 / -縮小 / リセット

### 3.3 配合計算

#### アルゴリズム（ベース色基準 + 適応的色数調整）

1. **ベース色の選定**
   - 目標色にLab色空間で最も近い色を「ベース色」として選択
   - ΔE < 3（人間の目では区別困難）の場合、ベース色100%で終了

2. **候補色の選定**
   - ベース色との差分を補正できる方向の色を優先的に選択
   - Lab色空間での内積（方向の一致度）でスコアリング
   - スコアの高い色を候補として追加

3. **Lab色空間で最適化**（CIE76 ΔE）
   - 人間の知覚に近い色差計算
   - RGB空間より正確な結果
   - ベース色を高比率で維持しながら最適化

4. **制約付き最適化**
   - 各色の比率: 0〜100%
   - 合計 = 100%
   - 1%未満の色は除外

5. **適応的色数調整**
   - 6色から開始
   - ΔE >= 5 の場合、2色ずつ追加して再最適化
   - ΔE < 5 になるまで、または全17色を使い切るまで繰り返す

### 3.4 結果表示
1. **円グラフ**: 配合比率を視覚的に表示（Chart.js）
2. **リスト**: 各色の配合比率をパーセンテージで表示
3. **再現色**: 配合結果のプレビュー色を表示
4. **色差（ΔE）**: 目標色との差異を表示
   - ΔE ≦ 5: 緑バッジ（優秀）
   - ΔE ≦ 10: 黄バッジ（良好）
   - ΔE > 10: 赤バッジ（要調整）

---

## 4. 非機能要件

### 4.1 対応環境
- PC（Windows, Mac, Linux）
- スマートフォン（iOS, Android）
- モダンブラウザ（Chrome, Firefox, Safari, Edge）

### 4.2 公開方式
- GitHub Pagesで無料ホスティング
- 登録不要で誰でもアクセス可能
- URL: https://colabpaint.github.io/angelus-color-mixer/

### 4.3 オフライン対応
- JavaScript版はサーバー不要で動作
- HTMLファイルを直接開いても使用可能

### 4.4 精度目標
- **ΔE ≦ 5を目指す**（人間の目でほぼ区別できないレベル）

---

## 5. システム構成

### 5.1 ファイル構成
```
AngelusColoraAdjustment/
├── index.html          # Webインターフェース（メイン）
├── color_mixer.py      # Python計算エンジン（CLI/API用）
├── app.py              # Flask APIサーバー
├── requirements.txt    # Python依存パッケージ
├── generate_qr.py      # QRコード生成スクリプト
├── 1.png               # 背景用総柄画像（Co-Lab Paint）
├── 要件定義書.md       # 本ドキュメント
├── 公開URL.txt         # 公開URLと使い方
├── QRコード.png        # 共有用QRコード
└── 0-Angelusカラーサンプル.jpg  # カラーチャート参考画像
```

### 5.2 技術スタック
| 項目 | 技術 |
|------|------|
| フロントエンド | HTML5, CSS3, JavaScript (Vanilla) |
| グラフ描画 | Chart.js |
| バックエンド（オプション） | Python, Flask |
| 最適化計算 | scipy.optimize（Python） / 勾配降下法（JavaScript） |
| 色空間 | CIE Lab（ΔE CIE76） |
| ホスティング | GitHub Pages |

---

## 6. 使用方法

### 6.1 Webアプリとして使用（推奨）
1. https://colabpaint.github.io/angelus-color-mixer/ にアクセス
2. 画像をドラッグ＆ドロップまたはCtrl+Vでペースト
3. 作りたい色をクリック
4. 配合比率が円グラフで表示される

### 6.2 コマンドラインで使用
```bash
pip install -r requirements.txt
python color_mixer.py "#FF8800"
```

### 6.3 ローカルサーバーで使用
```bash
pip install -r requirements.txt
python app.py
# ブラウザで http://localhost:5000 を開く
```

---

## 7. 今後の拡張案（未実装）

- [ ] Google Analytics によるアクセス解析
- [ ] 配合履歴の保存機能
- [ ] 減法混色のより精密なシミュレーション（Kubelka-Munk理論）
- [ ] PWA対応（オフラインインストール）
- [ ] 配合レシピの保存・共有機能

---

## 8. 開発履歴

| 日付 | 内容 |
|------|------|
| 2026-02-19 | 初期バージョン作成（6色対応） |
| 2026-02-19 | 画像ズーム・パン機能追加 |
| 2026-02-19 | GitHub Pages で公開 |
| 2026-02-19 | QRコード生成 |
| 2026-02-19 | Lab色空間対応、補助色12色追加 |
| 2026-02-19 | 配合色を最大6色に制限 |
| 2026-02-21 | ゴールド・ブロンズを削除、ホットピンクを追加 |
| 2026-02-21 | ベース色基準アルゴリズムに変更 |
| 2026-02-21 | 適応的色数調整（ΔE>=5で色数増加）を実装 |
| 2026-02-21 | 代替色の常時表示機能を追加（3件表示） |
| 2026-02-21 | 3カラムレイアウトに変更（1ページ収まり） |
| 2026-02-21 | Co-Lab Paint総柄背景を追加 |
| 2026-02-21 | ドロップゾーンの視認性改善 |

---

## 9. 参考情報

- 公開URL: https://colabpaint.github.io/angelus-color-mixer/
- GitHubリポジトリ: https://github.com/colabpaint/angelus-color-mixer
- Angelus公式: https://angelusdirect.com/
- QRコード: `QRコード.png`

---

## 10. 色差（ΔE）について

ΔE（デルタE）は、2つの色の知覚的な差を数値化したもの。

| ΔE値 | 意味 |
|------|------|
| 0〜1 | 人間の目では区別不可能 |
| 1〜2 | 注意深く見れば分かる程度 |
| 2〜5 | 一目で分かるが許容範囲 |
| 5〜10 | 明らかに違う色だが近い |
| 10以上 | 完全に別の色 |

本システムでは**ΔE ≦ 5**を目標としている。

---

## 11. UI/UXデザイン

### 11.1 レイアウト

**3カラムレイアウト**（PC表示時、画面幅1100px以上）

| 左カラム | 中央カラム | 右カラム |
|----------|------------|----------|
| 画像ドロップゾーン | ターゲット色・配合結果 | 代替色一覧 |

- 全体を `100vh` に固定し、スクロールなしで1ページに収まる
- 画面幅1100px未満では2カラム、900px未満では1カラムに変更

### 11.2 背景デザイン

- **Co-Lab Paint総柄**（`1.png`）を背景に使用
- 透過度: 15%
- タイル状に繰り返し表示

### 11.3 代替色の常時表示

目標色に対して作成可能な近い色を**常に3件表示**する機能。

**探索方法:**
- 単色: ΔE < 30 のもの
- 2色混合: 10%刻み（10%〜90%）で組み合わせ、ΔE < 15 のもの

**表示内容:**
- 色のプレビュー（スウォッチ）
- HEXコード
- ΔE値（色差）
- 配合説明（例: 「オレンジ 70% + イエロー 30%」）

**インタラクション:**
- クリックでその色をターゲット色として選択し、再計算

### 11.4 ドロップゾーン

画像アップロード用のドロップゾーン:

- 背景: `rgba(30, 35, 50, 0.85)` + `backdrop-filter: blur(8px)`
- ボーダー: ピンク系の破線 `rgba(233, 69, 96, 0.4)`
- アイコン: カメラ絵文字（📷）
- ホバー時: ボーダーが明るくなる
- ドラッグオーバー時: 背景がピンク系に変化

### 11.5 カラースキーム

| 要素 | 色 |
|------|-----|
| 背景グラデーション | `#1a1a2e` → `#16213e` |
| アクセントカラー | `#e94560`（ピンク） |
| 成功（ΔE ≦ 5） | `#00C864`（緑） |
| 警告（ΔE ≦ 10） | `#FFC800`（黄） |
| エラー（ΔE > 10） | `#ff6b6b`（赤） |
